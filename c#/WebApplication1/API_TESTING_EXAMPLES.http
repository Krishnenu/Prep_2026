# API Testing Examples - JWT Authorization

## Test these endpoints using Postman, Thunder Client, or cURL

### 1. REGISTER A NEW USER
POST http://localhost:5000/api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123"
}

### Expected Response:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "testuser",
  "email": "test@example.com"
}

---

### 2. LOGIN
POST http://localhost:5000/api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}

### Expected Response:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "testuser",
  "email": "test@example.com"
}

---

### 3. GET PROFILE (Protected - Requires JWT Token)
GET http://localhost:5000/api/auth/profile
Authorization: Bearer YOUR_JWT_TOKEN_HERE

### Expected Response:
{
  "username": "testuser",
  "email": "test@example.com",
  "message": "This is a protected endpoint"
}

### Without Token (Should Fail):
GET http://localhost:5000/api/auth/profile

### Expected Response: 401 Unauthorized

---

### 4. GET WEATHER FORECAST (Protected - Requires JWT Token)
GET http://localhost:5000/weatherforecast
Authorization: Bearer YOUR_JWT_TOKEN_HERE

### Expected Response:
{
  "message": "Weather forecast for testuser",
  "userId": "1",
  "username": "testuser",
  "email": "test@example.com",
  "forecast": [
    {
      "date": "2026-02-10",
      "temperatureC": 25,
      "temperatureF": 76,
      "summary": "Warm"
    },
    ...
  ]
}

---

### 5. GET CURRENT WEATHER (Protected - Requires JWT Token)
GET http://localhost:5000/weatherforecast/current
Authorization: Bearer YOUR_JWT_TOKEN_HERE

### Expected Response:
{
  "message": "Current weather for testuser",
  "temperature": 18,
  "summary": "Mild",
  "timestamp": "2026-02-09T07:16:49.123Z"
}

---

### 6. GET PUBLIC WEATHER (No Auth Required)
GET http://localhost:5000/weatherforecast/public

### Expected Response:
{
  "message": "This is a public endpoint - no JWT token required",
  "temperature": 22,
  "summary": "Balmy"
}

### Note: This endpoint works WITHOUT a token!

---

## cURL Commands

### Register
```bash
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"testuser\",\"email\":\"test@example.com\",\"password\":\"password123\"}"
```

### Login
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"testuser\",\"password\":\"password123\"}"
```

### Get Profile (Replace YOUR_TOKEN)
```bash
curl http://localhost:5000/api/auth/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Get Weather Forecast (Replace YOUR_TOKEN)
```bash
curl http://localhost:5000/weatherforecast \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Get Current Weather (Replace YOUR_TOKEN)
```bash
curl http://localhost:5000/weatherforecast/current \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Get Public Weather (No Token)
```bash
curl http://localhost:5000/weatherforecast/public
```

---

## PowerShell Commands

### Register
```powershell
Invoke-RestMethod -Uri "http://localhost:5000/api/auth/register" `
  -Method Post `
  -ContentType "application/json" `
  -Body '{"username":"testuser","email":"test@example.com","password":"password123"}'
```

### Login
```powershell
$response = Invoke-RestMethod -Uri "http://localhost:5000/api/auth/login" `
  -Method Post `
  -ContentType "application/json" `
  -Body '{"username":"testuser","password":"password123"}'

$token = $response.token
Write-Host "Token: $token"
```

### Get Profile
```powershell
$headers = @{
    "Authorization" = "Bearer $token"
}

Invoke-RestMethod -Uri "http://localhost:5000/api/auth/profile" `
  -Method Get `
  -Headers $headers
```

### Get Weather Forecast
```powershell
Invoke-RestMethod -Uri "http://localhost:5000/weatherforecast" `
  -Method Get `
  -Headers $headers
```

### Get Public Weather (No Token)
```powershell
Invoke-RestMethod -Uri "http://localhost:5000/weatherforecast/public" `
  -Method Get
```

---

## JavaScript/Fetch Examples

### Register
```javascript
const response = await fetch('http://localhost:5000/api/auth/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'testuser',
    email: 'test@example.com',
    password: 'password123'
  })
});

const data = await response.json();
console.log('Token:', data.token);
```

### Login
```javascript
const response = await fetch('http://localhost:5000/api/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    username: 'testuser',
    password: 'password123'
  })
});

const data = await response.json();
const token = data.token;
```

### Get Profile
```javascript
const response = await fetch('http://localhost:5000/api/auth/profile', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});

const profile = await response.json();
console.log(profile);
```

### Get Weather Forecast
```javascript
const response = await fetch('http://localhost:5000/weatherforecast', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});

const weather = await response.json();
console.log(weather);
```

---

## Expected Error Responses

### 401 Unauthorized (No Token)
```json
{
  "type": "https://tools.ietf.org/html/rfc7235#section-3.1",
  "title": "Unauthorized",
  "status": 401
}
```

### 401 Unauthorized (Invalid Credentials)
```json
{
  "message": "Invalid username or password"
}
```

### 400 Bad Request (Validation Error)
```json
{
  "message": "Username or email already exists"
}
```

---

## Testing Workflow

1. **Register** a new user → Get token
2. **Login** with credentials → Get token
3. **Test protected endpoints** with token → Should work
4. **Test protected endpoints** without token → Should fail (401)
5. **Test public endpoints** without token → Should work
6. **Wait 24 hours** → Token expires → Should fail (401)

---

## Verify JWT Token

You can decode and verify your JWT token at: https://jwt.io

Paste your token to see:
- Header (algorithm, type)
- Payload (claims: username, email, userId, expiration)
- Signature (verification)

**Note:** The token is signed with your secret key from `appsettings.json`
